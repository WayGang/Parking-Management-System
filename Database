Mysql Database

There are 3 tables in the database "SMARTPARKER"

1.cars_in
which means at the moment, all cars in the parking lot will be in this table


2.cars_all
which records all cars in history has come in and come out. 
Every single action will be recorded in this table.
Also, the picture (as a proof) will be recorded as a image path in this table.


2.cars_balance
I use this table to load the balance money of the specific car. And also, 
due to the unrepeatablility, whether or not
the car has been in this parking lot will be decided using this table.


The program will straightly read information from the table "cars_in"
The program will load everything to the table "cars_all"


CREATE TABLE `cars_all` (
  `license_id` varchar(30) NOT NULL,
  `entry_time` timestamp(1) NOT NULL,
  `exit_time` timestamp(1) NULL DEFAULT NULL,
  `balance` float DEFAULT NULL,
  `image_path` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`entry_time`,`license_id`),
  KEY `license_id_idx` (`balance`),
  KEY `entry_time_idx` (`entry_time`),
  KEY `license_id` (`license_id`),
  CONSTRAINT `license_id` FOREIGN KEY (`license_id`) REFERENCES `cars_balance` (`license_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci


CREATE TABLE `cars_in` (
  `license_id` varchar(30) NOT NULL,
  `entry_time` timestamp(1) NULL DEFAULT NULL,
  `balance` float DEFAULT NULL,
  `images_path` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`license_id`),
  KEY `license_id_idx` (`license_id`,`balance`),
  KEY `balance_idx` (`balance`),
  KEY `entry_time_idx` (`entry_time`),
  CONSTRAINT `entry_time` FOREIGN KEY (`entry_time`) REFERENCES `cars_all` (`entry_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8


CREATE TABLE `cars_balance` (
  `license_id` varchar(30) NOT NULL,
  `balance` float DEFAULT NULL,
  PRIMARY KEY (`license_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci



from license_image_extraction import extraction
from recognize_license_id import *
import pymysql
import pymysql
'''
import pandas as pd
import numpy as np
import MySQLdb'''

car_path = "/Users/gangwei/Desktop/smartparker/car_image/car6.jpg"
license_plate_path = '/Users/gangwei/Desktop/smartparker/license_image'
json_path = "/Users/gangwei/Desktop/smartparker/textdetect-52e8d68b62cc.json"

entry_time = extraction.time_extraction(car_path)

print(entry_time)
#extraction.store_license_plate(car_path,license_plate_path)

license_id = text.recognize(license_plate_path,json_path)
print(license_id)
# !/usr/bin/python3
balance = 300

# 打开数据库连接
db = pymysql.connect("localhost", "root", "WeiGang0502", "smartparker")

# 使用cursor()方法获取操作游标
cursor = db.cursor()

# SQL 插入语句
#sql = """INSERT INTO cars_all(license_id,entry_time, balance)
#       values("%s", "%s"，"%s")""" % (license_id, entry_time, balance)

sql = "INSERT INTO cars_all(license_id, entry_time, balance) VALUES(\'%s\', \'%s\', \'%s\')" % (license_id, entry_time,  balance)


#try:
    # 执行sql语句
cursor.execute(sql)
    # 提交到数据库执行
db.commit()

#except:
    # 如果发生错误则回滚
    #db.rollback()

# 关闭数据库连接
#db.close()

'''


only add:           cars_all license_id entry exit balance path
add or delete:      cars_in  license_id entry balance
only update:        cars_bal license_id entry exit balance(initial = 300)

car comes in: if not exist, txt, entry send to .bal,add
              if exist, update entry; null exit
              
              txt, time and path send to .all, add; txt, time send to .in, add;
              
car out :      update exit; cost send to .bal; balance -= cost
              
              txt, time and path send to .all, add; txt send to .in, delete;

where in.id == bal.id , set in.balance = bal.balance
where in.id == all.id && in.entry == all.entry , set in.path = all.path
where all.entry == bal.entry , set all.balance = bal.balance





'''
